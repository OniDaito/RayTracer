cmake_minimum_required(VERSION 3.0.0)

PROJECT(rays)
include(cmake/RaysVersion.cmake)
include(cmake/RPMPackage.cmake)
include(cmake/BuildInfo.cmake)

# GLM Includes
include_directories( "include/glm" )

# Basic includes
include_directories( "include" )

# Include the binary dir for autogenerated headers
include_directories( ${CMAKE_CURRENT_BINARY_DIR} ) 

# MPI
option(USE_MPI "Use MPI for larger parallel sections" NO)

# OpenMP
option(USE_OPENMP "Use OpenMP for parallel sections" YES)

ADD_EXECUTABLE(rays src/geometry.cpp src/main.cpp src/obj_loader.cpp src/file.cpp src/scene.cpp src/bmp.cpp src/tracer.cpp)

# Options 
SET(CMAKE_CXX_FLAGS "-std=c++11 -static-libstdc++")
SET(CMAKE_CXX_FLAGS_DEBUG "-g -std=c++11 -static-libstdc++")

# Require MPI for this project or OpenMP

if (USE_MPI)
  SET(CMAKE_C_COMPILER mpicc)
  SET(CMAKE_CXX_COMPILER mpicxx)
  find_package(MPI REQUIRED)
  set(CMAKE_SHARED_LINKER_FLAGS ${CMAKE_SHARED_LINKER_FLAGS} ${MPI_LINK_FLAGS})
  include_directories(MPI_INCLUDE_PATH)
  target_link_libraries(rays ${MPI_LIBRARIES} X11) 
endif()

if (USE_OPENMP)
  SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fopenmp")
  target_link_libraries(rays X11)
endif()
